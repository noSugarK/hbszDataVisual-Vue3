```mermaid
erDiagram
    %% ========== 实体间关系 ==========
    
    USER ||--o{ PROJECT_PERMISSION : "has"
    PROJECT ||--o{ PROJECT_PERMISSION : "has"

    USER ||--o{ ORDER : "creates"
    USER ||--o{ ORDER : "approves" 
    USER ||--o{ GUIDE_PRICE : "uploads"
    USER ||--o{ DATA_SUBMISSION : "submits"
    USER }|--o{ USER : "created_by" 
    USER ||--o{ PROJECT : "created_by_project"

    REGION ||--o{ PROJECT : "contains"
    REGION ||--o{ GUIDE_PRICE : "has_prices"
    REGION ||--o{ REGION : "parent-child"

    CATEGORY ||--o{ SPECIFICATION : "has_specs"
    CATEGORY ||--o{ ORDER : "categorized_in"
    CATEGORY ||--o{ GUIDE_PRICE : "priced_category"

    SPECIFICATION ||--o{ ORDER : "specified_in"
    SPECIFICATION ||--o{ GUIDE_PRICE : "specified_in"

    BRAND ||--o{ ORDER : "used_in"

    SUPPLIER ||--o{ ORDER : "supplies_to"

    PROJECT ||--o{ ORDER : "includes_orders"

    DATA_SUBMISSION ||--o{ ORDER : "generates" 
    DATA_SUBMISSION ||--o{ GUIDE_PRICE : "generates"

    %% ========== 多态日志关系（特殊处理）==========
    PERMISSIONS_LOG }o--|| USER : "user"
    PERMISSIONS_LOG }o--|| USER : "admin"
    
    %% ========== 核心实体 ==========

    REGION {
        int id PK
        string name
        string level  "city|district"
        int parent_id FK "仅区县指向所属市；市级可为空"
    }

    GUIDE_PRICE {
        int id PK
        date date  "日期（月）"
        int region_id FK "REGION.id（指向市 或 区县）"
        int specification_id FK "规格"
        int category_id FK "物资类别"
        decimal unit_price  "信息价"
        int user_id FK "指向录入用户id"
    }

    USER {
        int id PK
        string username  "用户名，唯一"
        string password  "密码，加密存储"
        string full_name  "姓名"
        bool is_superuser  "是否为超级管理员"
        bool is_staff  "是否为管理员"
        bool is_active  "是否激活"
        datetime date_joined  "加入时间"
        string phone  "手机号，唯一"
        string email  "邮箱地址，唯一"
        int created_by FK "创建者ID，关联USER表id"
        datetime last_login  "最后登录时间"
    }

    PROJECT_PERMISSION {
        int id PK
        int user_id FK "关联USER表id"
        int project_id FK "关联PROJECT表id"
        string permission_type  "权限类型：view|edit|add|manage"
        string unique_constraint "user_id, project_id 确保用户对同一项目只有一条权限记录"
    }

    PERMISSIONS_LOG {
        int id PK
        datetime created_at  "创建时间"
        int user_id FK "关联USER表id"
        int admin_id FK "关联USER表id"
        string target_type  "目标类型：'project', 'user'"
        int target_id FK "关联PROJECT表id 或 USER表id"
        string action  "操作：add|edit|delete"
        string old_permission  "权限类型：view|edit|add|manage"
        string new_permission  "权限类型：view|edit|add|manage"
        string ip_address  "IP地址"
    }

    CATEGORY {
        int id PK
        string category_name  "物资类别名称"
    }

    SPECIFICATION {
        int id PK
        string specification_name  "规格名称"
        int category_id FK
    }

    BRAND {
        int id PK
        string brand_name  "品牌名称"
        string description  "描述"
    }

    PROJECT {
        int id PK
        string project_name  "项目名称"
        int region_id FK "指向地区id"
        string status  "状态：inactive|active|closed"
        int created_by FK "创建者ID，关联USER表id"
    }
    
    SUPPLIER {
        int id PK
        string supplier_name  "供应商名称"
    }

    ORDER {
        int id PK
        int project_id FK "指向项目id"
        date arrival_date  "到货时间"
        int supplier_id FK "指向供应商id"
        int category_id FK "指向物资类别id"
        int specification_id FK "指向规格id"
        decimal quantity  "数量"
        decimal purchase_price  "采购价"
        decimal discount_rate  "折扣率"
        decimal total_amount  "总金额"
        int brand_id FK  "指向品牌id"
        int user_id FK  "指向创建用户id"
        string status  "订单状态：pending|approved|shipped|received|cancelled"
        int approved_by FK "审批人ID，关联USER表id"
    }

    DATA_SUBMISSION {
        int id PK
        int user_id FK "USER.id"
        string source_type  "'manual' | 'file_upload' | 'api'"
        string file_path  "仅当 source_type=file_upload 时有值"
        int record_count  "本次填报/导入的记录条数"
        string status  "'pending', 'success', 'failed', 'reviewed'"
        text error_log  "导入失败时的错误信息"
        datetime submitted_at  "填报时间"
        datetime processed_at  "处理完成时间"
        string submission_type  "可选：'guide_price', 'material_info' 等"
    }
```